# Hello, Documents Speaking

Turns your documents into an entity with feelings, emotions, and DATA, so that you can converse with them.

## Features

- **Real-time WebSocket chat** with instant user feedback
- **Asynchronous AI processing** for optimal UX
- **PDF text extraction** using MuPDF
- **S3 file storage** integration
- **JWT authentication** with Rails compatibility
- **PostgreSQL database** with Ecto ORM

## Quick Start

### Prerequisites

- **Elixir 1.15+** and **Erlang/OTP 26+**
- **PostgreSQL 12+** (shared with boost-api)
- **MuPDF tools**: `brew install mupdf-tools`
- **AWS S3** account and bucket
- **OpenAI API** key

### Setup

1. **Install dependencies:**
   ```bash
   git clone <repo_url>
   cd hello-documents-speaking
   mix deps.get
   ```

2. **Configure environment:**
   ```bash
   cp envs/.env-example envs/.env
   # Edit .env with your credentials
   ```

3. **Start the service:**
   ```bash
   mix run --no-halt
   ```

Server runs on `http://localhost:4000`

## API Overview

### Health Check
```bash
curl http://localhost:4000/health
```

### Document Chat WebSocket
```bash
# Connect
wscat -c "ws://localhost:4000/api/document-chat" \
       -H "Authorization: Bearer YOUR_TOKEN"

# Initialize conversation
{"type": "init", "document_ids": [1], "prospect_id": 123}

# Send message
{"type": "message", "content": "What does this document say?"}
```

## Development

### Interactive Shell
```bash
iex -S mix
```

### Testing
```bash
mix test
mix format
```

## Documentation

- **[Best Practices](docs/BEST_PRACTICES.md)** - Development patterns, adding WebSocket handlers, code organization
- **[Debug Guide](docs/DEBUG.md)** - Troubleshooting, debugging tools, common issues

## Architecture

This service works alongside `boost-api`:
- Shares PostgreSQL database with Rails naming conventions
- Reads files from same S3 bucket (Rails Active Storage format)
- Maintains API compatibility with camelCase/snake_case conversion
- Supports JWT tokens generated by Rails Devise

### Code Organization

```
lib/hello_documents_speaking/
├── clients/           # External API clients (OpenAI)
├── models/            # Database schemas
├── services/          # Business logic (DocumentAI, PDF extraction)
└── web/              # Web layer (auth, routers, sockets, utils)
    ├── sockets/       # WebSocket handlers
    └── utils/         # Utilities (CORS, JSON conversion)
```

The WebSocket implementation provides real-time document analysis that replaces Apollo GraphQL subscriptions with better performance and UX.
